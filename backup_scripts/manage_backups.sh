#!/bin/bash

BACKUP_DIR="./backups"

echo "üõ†Ô∏è –ú–µ–Ω–µ–¥–∂–µ—Ä –±—ç–∫–∞–ø–æ–≤ Metabase"
echo "=============================="
echo ""

while true; do
    echo "1. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø"
    echo "2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞"
    echo "3. –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤"
    echo "4. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã"
    echo "5. –í—ã–π—Ç–∏"
    echo ""
    read -p "üî¢ –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1-5): " action

    case $action in
        1)
            echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞..."
            ./backup_scripts/backup_metabase.sh
            ;;
        2)
            echo "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞..."
            ./backup_scripts//restore_metabase.sh
            ;;
        3)
            echo "üìã –°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤:"
            if [ -d "$BACKUP_DIR" ]; then
                ls -la "$BACKUP_DIR"/*.mv.db 2>/dev/null | awk '{print $9 " (" $5 " bytes, " $6 " " $7 " " $8 ")"}'
            else
                echo "‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –±—ç–∫–∞–ø–∞–º–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            fi
            ;;
        4)
            echo "üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤..."
            read -p "‚ùì –°–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±—ç–∫–∞–ø–æ–≤ –æ—Å—Ç–∞–≤–∏—Ç—å? (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10): " keep
            if [[ "$keep" =~ ^[0-9]+$ ]]; then
                ls -t "$BACKUP_DIR"/*.mv.db 2>/dev/null | tail -n +$(($keep+1)) | xargs rm -f
                echo "‚úÖ –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã, –æ—Å—Ç–∞–≤–ª–µ–Ω–æ $keep –ø–æ—Å–ª–µ–¥–Ω–∏—Ö"
            else
                echo "‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ —á–∏—Å–ª–æ"
            fi
            ;;
        5)
            echo "üëã –í—ã—Ö–æ–¥"
            exit 0
            ;;
        *)
            echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
            ;;
    esac

    echo ""
    echo "-----------------------------"
    echo ""
done